---
title: "p8105_hw3_zc2822"
author: "Zhengyong Chen"
output: github_document
---

```{r setup, echo=FALSE, message=FALSE}
library(tidyverse)
library(ggplot2)
```

## Problem 2

Load, tidy, merge, and organize the data sets. 

```{r, message=FALSE}
demo_df = 
  read_csv("data/nhanes_covar.csv", na = c("NA", ".", ""), skip = 4) |> 
  janitor::clean_names() |> 
  filter(age >= 21, 
         !is.na(sex), !is.na(age), !is.na(bmi), !is.na(education)) |> 
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female"), ordered = TRUE),
    education = factor(education, levels = c(1, 2, 3), 
                       labels = c("Less than HS", "HS equivalent", "More than HS"), 
                       ordered = TRUE)
  )

accel_df = 
  read_csv("data/nhanes_accel.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names()

mims_df <- left_join(demo_df, accel_df, by = "seqn")
```

Table for the number of men and women in each education category.

```{r, message=FALSE}
demo_df |> 
  group_by(education, sex) |> 
  summarise(count = n()) |> 
  pivot_wider(
    names_from = sex,
    values_from = count
  ) |> 
  knitr::kable()
```

Visualization of the age distributions for men and women in each education category. 

```{r}
demo_df |> 
  group_by(education, sex) |> 
  ggplot(aes(x = education, y = age, fill = sex)) +
  geom_boxplot(alpha = .5) +
  scale_fill_manual(values = c("Male" = "blue", "Female" = "red")) +
  labs(title = "Age distributions for men and women in each education category")
```

Comment:

The younger age group (<40) of female tends to have a more than high school education, and that of male tends to have a high school equivalent and more than high school education.

For the less than high school education category, the age spread of male and female does not differ much, with medians around 60, which is a little bit larger in female group, but the largest age in male group is larger than that in female group.

For the high school equivalent education category, from both the age spread and the median, male tends to be younger than female.

For the more than high school education category, the age spread of male and female does not differ much, but the female group has a smaller median.



Plot total activities against age. 

```{r, message = FALSE}
mims_df |> 
  rowwise() |> 
  mutate(total_activity = sum(c_across(starts_with("min")), na.rm = TRUE)) |> 
  ungroup() |> 
  ggplot(aes(x = age, y = total_activity, col = sex)) +
  geom_point(alpha = .5) +
  scale_color_manual(values = c("Male" = "blue", "Female" = "red")) +
  facet_wrap(~ education) + 
  geom_smooth(se = FALSE) + 
  labs(title = "Total activity vs age by education level and sex",
       x = "Age", 
       y = "Total Activity")
```

Comment:

Total activity tends to decrease with age in all education groups, but the patterns are different. Female generally have higher total activity compared to male in more than or equivalent to high school education groups.

For the less than high school group, female shows an overall decreasing trend of total activity as age increases, while male first decreases in total activity, then rises to a peak at around age 60, and then decreases sharply.

For the high school equivalent group, female has two peaks of total activity, one at age 40, and the other at age 70. Male's total activity increases before age 40, and then decreases.

For the more than high school group, both sexes show an flat trend of total activity until around age 50, then decrease sharply.




